---
description: Persistent memory for learnings across sessions
globs: []
alwaysApply: true
---

## Agent Memory

Shared memory file for both Cursor and Claude Code agents. When you encounter a mistake that could recur, or learn something important about this project, append it to this file under the relevant heading below. Keep entries concise. Remove entries that turn out to be wrong or outdated.

**At the end of every task session, update this file** with any new learnings before your final response. Don't ask — just do it. If nothing was learned, skip silently.

### Project structure
- Eleventy (11ty) personal blog with Nunjucks templates
- Agent instructions live in `.cursor/rules/*.mdc` (Cursor) and `CLAUDE.md` (Claude Code)
- CLAUDE.md uses `@` imports to pull in cursor rules and docs — avoids duplication
- Docs: `docs/commands.md`, `docs/authoring.md`, `docs/tests.md`, `docs/ideas.md`
- `docs/ideas.md` is the task tracker — has Selected, Future, Maybe Don't, and Done sections
- Reminders use format: `- [ ] **REMINDER (YYYY-MM-DD)**: description`
- Eleventy config is modularized in `eleventy/config/` (filters, plugins, events, etc.) and `eleventy/utils/` (markdown, date, CSS utilities)
- `eleventy/config/transforms.js` is intentionally empty — figure wrapping moved to markdown-it plugin at parse time

### Command relationships
- `deploy` runs: `import-links` → `changelog` → `generate-og-images` → `test markdown` → `test frontmatter` → `build` → `test og-images` → rsync → IndexNow
- `test fast` runs 11 tests; `test all` adds `a11y`
- `dev` auto-generates OG images on file save via `eleventy.beforeWatch`
- `validate` is shortcut for `test html`

### Workflow preferences
- User commits intentionally — never commit without being asked
- Pre-existing unstaged changes should be left alone (don't include unrelated files)
- User values concise communication and clear tradeoff analysis
- User uses both Cursor and Claude Code — this file is the shared memory for both
- When modifying docs, check for stale cross-references across all doc files

### DRY decisions
- OG image preview uses Eleventy's native `renderFile` shortcode (RenderPlugin) + `og-image-body.njk` partial — no custom Nunjucks env needed
- `generate-og-images.js` still has its own Nunjucks env with inline `postDate` and `extractCssCustomProperties` — known remaining DRY opportunity, acceptable because it runs outside Eleventy
- Shared PDF conversion functions live in `scripts/utils/pdf-utils.js`
- User rejected a `readMarkdownFile()` consolidation utility — the pattern repeats across scripts but a shared helper added indirection without clear payoff

### Gotchas
- `.cursor/rules/*.mdc` files have YAML frontmatter (globs, alwaysApply) that Claude Code ignores — content is still valid markdown after the frontmatter
- `convert-pdf-with-notes` exists in package.json but isn't documented in commands.md (intentional or oversight — not yet clarified)
- **Date handling is load-bearing** — `addDateParsing` (timezone-aware) + permalink generation preserve WordPress-era URLs. Do not simplify without verifying every URL remains unchanged.
- Figure captions use the convention: image line immediately followed by `*caption text*` (no blank line). The `markdown-it-figure` plugin in `eleventy/utils/markdown-it-figure.js` handles this at parse time.
- Redirects: add entries to `src/_data/redirects.yaml` — the `src/.htaccess.njk` template renders them automatically via the data cascade. No separate script needed.

### What worked
- Parallel agents work well for independent code changes (e.g., two unrelated simplifications at once)
